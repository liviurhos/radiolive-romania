<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Radio Live Romania/UK - Listen to FM & online stations with live now playing and logos automatically loaded." />
<title>Radio Live Romania/UK - Online Radio Player</title>
<link rel="icon" href="favicon.png" type="image/png" />
<style>
  :root {
    --bg-light: #f0f0f0;
    --text-light: #222;
    --card-light: #99ffd6;
    --bg-dark: #1e1e1e;
    --text-dark: #e0e0e0;
    --card-dark: #2b2b2b;
  }
  body {
    font-family: 'Segoe UI', 'Segoe UI Emoji', 'Apple Color', sans-serif;
    background: #4da6ff;
    color: var(--text-light);
    min-height: 100vh;
    margin: 0; display: flex;
    justify-content: center;
    align-items: center;
    transition: background 0.3s, color 0.3s;
  }
  .card {
    background: var(--card-light);
    padding: 1.1em 1.2em;
    border-radius: 18px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.14);
    max-width: 540px; width: 100%;
    text-align: center;
    transition: background 0.3s;
  }
  body.dark { background: var(--bg-dark); color: var(--text-dark);}
  body.dark .card { background: var(--card-dark);}
  h1, .status, .bitrate {
    font-size: 1.5em;
    font-weight: 600;
    margin-bottom: 0.3em;
    display: flex;
    align-items: center;
    justify-content: center; gap: 0.12em;
  }
  .icon {font-size: 1.65em; animation: pulse 1.8s infinite;}
  @keyframes pulse {0%,100%{transform:scale(1);opacity:1;}50%{transform:scale(1.11);opacity:.83;}}
  .title {background: linear-gradient(45deg,#1976d2,#42a5f5);-webkit-background-clip: text;-webkit-text-fill-color: transparent;}
  label { font-weight: bold;font-size: 1.1em; display: block; margin-bottom: 0.3em;}
  select {width: 100%;padding: 0.6em;font-size: 1em;border-radius: 8px;border: 1px solid #ccc; margin-bottom: 1.1em;}
  select:focus {border-color: #2196f3;outline: none;}
  audio {width: 100%; margin-top: 1em;}
  #stationLogo {
    width: 96px; height: 96px;
    object-fit: contain;
    margin: 1em auto;
    display: none;
    border-radius: 12px;
    box-shadow: 0 3px 15px rgba(0,0,0,0.15);
  }
  .bitrate {margin-top: 0.5em;font-size: 1.07em;color:#075; opacity: 0.88;}
  .status {margin-top: 0.45em;font-size: 1.05em; opacity: 0.89;}
  .toggle-theme {margin-top: 1em; cursor: pointer; background: none; border: none; font-size:1.1em; color:#2196f3;}
  .toggle-theme:hover { color: #1976d2;}
  .volume-controls {display:flex; align-items:center; gap:0.2em;margin-top:1em;}
  .volume-controls input[type="range"] {flex:1;}
  .nav-buttons {display:flex;justify-content:space-between;margin:1em 0 0.3em;gap:1em;}
  .nav-buttons button {background:black; border:none; border-radius:10px;cursor:pointer;height:44px;width:74px;display:flex;align-items:center;justify-content:center;}
  .nav-buttons button:focus {outline:2px solid #1976d2;}
  .nav-buttons button:hover {background: #4293f5;}
  .nav-buttons svg {width:46px;height:24px;}
  body.dark .nav-buttons button:hover {background:rgba(200,220,250,0.07);}
  footer {margin-top:2em;font-size:1em;text-align:center;color:black;}
  body.dark footer { color: #ccc;}
  #footerText {color: inherit;}
  [aria-live] { font-weight: 500; }
  @media (prefers-color-scheme: dark) {
    body:not(.light) {background: #1e1e1e; color: #e0e0e0;}
    .card {background: #2b2b2b;}
    footer {color: #ccc;}
  }
  .warning {color:#c00; font-weight:600;}
</style>
</head>
<body>
  <div class="card">
    <h1>
      <span class="icon">üìª</span>
      <span class="title">Radio Live Romania/UK</span>
    </h1>
    <label for="stationSelector">Select a radio station:</label>
    <select id="stationSelector"></select>
    <div id="stationWarning" class="warning" style="display:none"></div>
    <img id="stationLogo" src="" alt="Radio station logo" />
    <div class="bitrate" id="bitrateDisplay">üì∂ Bitrate: ?</div>
    <div class="volume-controls">
      <span>üîá</span>
      <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1" />
      <span id="volumeIcon">üîä</span>
    </div>
    <p id="iosWarning" style="display:none;font-size:0.88em;color:#c00;margin-top:0.7em;">
      ‚ö†Ô∏è Volume control is unavailable on iPhone. Use the physical volume buttons.
    </p>
    <audio id="radioPlayer" controls autoplay></audio>
    <div class="nav-buttons">
      <button id="prevStation" title="Previous station" aria-label="Previous station">
        <svg viewBox="0 0 56 34"><rect x="8" y="7" width="4" height="20" rx="2" fill="white"/><polygon points="26,7 10,17 26,27" fill="white"/><polygon points="39,7 23,17 39,27" fill="white"/></svg>
      </button>
      <button id="nextStation" title="Next station" aria-label="Next station">
        <svg viewBox="0 0 56 34"><rect x="44" y="7" width="4" height="20" rx="2" fill="white"/><polygon points="30,7 46,17 30,27" fill="white"/><polygon points="17,7 33,17 17,27" fill="white"/></svg>
      </button>
    </div>
    <div id="status" class="status" aria-live="polite"></div>
    <div id="nowPlaying" class="status" aria-live="polite"></div>
    <button class="toggle-theme" id="toggleTheme"></button>
    <footer>
      <span id="footerText">Powered by LAARB‚Ñ¢ STUDIO PRODUCTION</span>
    </footer>
  </div>

<script>
const stations = [
  { name: "Kiss FM (RO)", url: "https://live.kissfm.ro/kissfm.aacp", bitrate: "128 kb/s", fallbackLogo: "logos/kiss_fm.png" },
  { name: "Radio ZU (RO)", url: "https://ivm.antenaplay.ro/liveaudio/radiozu/playlist.m3u8", bitrate: "128 kb/s", fallbackLogo: "logos/radio_zu.png" },
  { name: "Play Radio Constan»õa - 90's (RO)", url: "https://live.playradio.org:8443/90HD", bitrate: "256 kb/s", fallbackLogo: "logos/play_radio.png" },
  { name: "Radio ProB (RO)", url: "https://live.radioprob.ro:8888/;", bitrate: "192 kb/s", fallbackLogo: "logos/radioprob.png" },
  { name: "Digi 24 (RO)", url: "https://edge126.rcs-rds.ro/digifm/digi24fm.mp3", bitrate: "128 kb/s", fallbackLogo: "logos/digi24.png" },
  { name: "Europa FM (RO)", url: "https://astreaming.edi.ro:8443/EuropaFM_aac", bitrate: "128 kb/s", fallbackLogo: "logos/europafm.png" },
  { name: "Magic FM (RO)", url: "https://live.magicfm.ro/magicfm.aacp", bitrate: "128 kb/s", fallbackLogo: "logos/magic_fm.png" },
  { name: "Rock FM (RO)", url: "https://live.rockfm.ro:8443/rockfm.aacp", bitrate: "128 kb/s", fallbackLogo: "logos/rock_fm.png" },
  { name: "Radio FolkBG (BG)", url: "http://listen.folkbg.net:8001/folkbg", bitrate: "320 kb/s", fallbackLogo: "logos/folkbg.png" },
  { name: "Radio Manele Vechi - Romania (RO)", url: "http://rostr1.radioolsztyn.pl:8443/RO.mp3", bitrate: "128 kb/s", fallbackLogo: "logos/image.png" },
  { name: "Capital FM (UK)", url: "https://ice-sov.musicradio.com/CapitalCymru", bitrate: "128 kb/s", fallbackLogo: "logos/image.png" },
  { name: "Capital Dance (UK)", url: "https://ice-sov.musicradio.com/CapitalDanceMP3", bitrate: "128 kb/s", fallbackLogo: "logos/image.png" },
  { name: "Gold (UK)", url: "https://ice-sov.musicradio.com/GoldMP3", bitrate: "128 kb/s", fallbackLogo: "logos/image.png" },
  { name: "Heart 00s (UK)", url: "https://icecast.thisisdax.com/Heart00sMP3", bitrate: "128 kb/s", fallbackLogo: "logos/image.png" },
  { name: "Smooth Chill (UK)", url: "https://ice-sov.musicradio.com/SmoothChillMP3", bitrate: "128 kb/s", fallbackLogo: "logos/image.png" },
  { name: "Heart 90s (UK)", url: "https://ice-sov.musicradio.com/Heart90sMP3", bitrate: "128 kb/s", fallbackLogo: "logos/image.png" },
  { name: "Heart Dance (UK)", url: "https://icecast.thisisdax.com/HeartDanceMP3", bitrate: "128 kb/s", fallbackLogo: "logos/image.png" },
  { name: "Virgin Radio (UK)", url: "https://radio.virginradio.co.uk/stream", bitrate: "320 kb/s", fallbackLogo: "logos/image.png" }
];

const stationSelector = document.getElementById('stationSelector');
const radioPlayer = document.getElementById('radioPlayer');
const status = document.getElementById('status');
const toggleThemeBtn = document.getElementById('toggleTheme');
const stationLogo = document.getElementById('stationLogo');
const bitrateDisplay = document.getElementById('bitrateDisplay');
const volumeSlider = document.getElementById('volumeSlider');
const volumeIcon = document.getElementById('volumeIcon');
const iosWarning = document.getElementById('iosWarning');
const nowPlaying = document.getElementById('nowPlaying');
const prevStationBtn = document.getElementById('prevStation');
const nextStationBtn = document.getElementById('nextStation');
const stationWarning = document.getElementById('stationWarning');

let nowPlayingInterval = null;

/**
 * Fill dropdown with station names
 */
function fillStationList() {
  stationSelector.innerHTML = stations.map((s,i) =>
    `<option value="${i}">${s.name}</option>`
  ).join('');
}

/**
 * Returns current selected station object
 */
function getStation() {
  return stations[parseInt(stationSelector.value,10)] || stations[0];
}

/**
 * Fetch logo URL from Radio Browser API by station name
 * Fallback to local logo if fail or no logo found
 */
async function fetchStationLogo(stationName, fallback) {
  try {
    const corsProxy = 'https://corsproxy.io/?';
    const apiUrl = corsProxy + `https://de1.api.radio-browser.info/json/stations/search?name=${encodeURIComponent(stationName)}&limit=1`;
    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error("API err");
    const data = await res.json();
    if (data && data[0] && data[0].favicon && data[0].favicon.startsWith('http')) {
      return data[0].favicon;
    }
  } catch (e) {
    // console.warn("Logo fetch error", e);
  }
  return fallback;
}


/**
 * Update station logo with fetched or fallback
 */
async function updateLogo(station) {
  const logoUrl = await fetchStationLogo(station.name, station.fallbackLogo);
  stationLogo.src = logoUrl;
  stationLogo.alt = "Logo " + station.name;
  stationLogo.style.display = 'block';
}

/**
 * Update bitrate display
 */
function updateBitrate(station) {
  bitrateDisplay.textContent = `üì∂ Bitrate: ${station.bitrate || "?"}`;
}

/**
 * Update status message
 */
function updateStatus(msg) {
  status.textContent = msg;
}

/**
 * Show or hide warnings
 */
function displayWarning(message) {
  if (message) {
    stationWarning.style.display = 'block';
    stationWarning.textContent = message;
  } else {
    stationWarning.style.display = 'none';
    stationWarning.textContent = '';
  }
}

/**
 * Update Now Playing text
 * For demo, fallback display station name,
 * Extendable to fetch now playing info if API available
 */
function setNowPlaying(station) {
  clearInterval(nowPlayingInterval);
  nowPlaying.textContent = `Now Playing: ${station.name}`;
  // Extend: add API fetch here if available for now playing
  // Currently fallback for demonstration
}

/**
 * Initialize the player with selected station
 */
async function initPlayer() {
  const s = getStation();
  radioPlayer.src = s.url;
  updateBitrate(s);
  await updateLogo(s);
  setNowPlaying(s);
  displayWarning('');
  updateStatus('Loading...');
  radioPlayer.play()
    .then(()=>updateStatus('Playing!'))
    .catch(()=>updateStatus('Error playing'));
}

// Event listeners
stationSelector.addEventListener('change', () => {
  initPlayer();
  localStorage.setItem('lastStationIdx', stationSelector.value);
});

document.getElementById('prevStation').addEventListener('click', () => {
  let idx = parseInt(stationSelector.value,10);
  idx = (idx - 1 + stations.length) % stations.length;
  stationSelector.value = idx;
  stationSelector.dispatchEvent(new Event('change'));
});

document.getElementById('nextStation').addEventListener('click', () => {
  let idx = parseInt(stationSelector.value,10);
  idx = (idx + 1) % stations.length;
  stationSelector.value = idx;
  stationSelector.dispatchEvent(new Event('change'));
});

volumeSlider.addEventListener('input', () => {
  radioPlayer.volume = volumeSlider.value;
  volumeIcon.textContent = radioPlayer.volume == 0 ? 'üîá' : 'üîä';
  localStorage.setItem('radioVolume', radioPlayer.volume);
});

const isIOS = /iP(ad|hone|od)/.test(navigator.userAgent) && !window.MSStream;
if(isIOS){
  document.querySelector('.volume-controls').style.display='none';
  iosWarning.style.display='block';
}

// Theme toggle
function setTheme(cls) {
  document.body.classList.toggle('dark', cls==='dark');
  document.body.classList.toggle('light', cls==='light');
  toggleThemeBtn.textContent = document.body.classList.contains('dark')
    ? "‚òÄÔ∏è Switch to light mode"
    : "üåô Switch to dark mode";
}
toggleThemeBtn.addEventListener('click', () => {
  const nowDark = !document.body.classList.contains('dark');
  setTheme(nowDark ? 'dark' : 'light');
  localStorage.setItem('theme', nowDark ? 'dark' : 'light');
});

window.addEventListener('DOMContentLoaded', () => {
  fillStationList();
  let lastIdx = parseInt(localStorage.getItem('lastStationIdx')||'0',10);
  lastIdx = (isNaN(lastIdx) || lastIdx<0 || lastIdx>=stations.length) ? 0 : lastIdx;
  stationSelector.value = lastIdx;

  const themeLS = localStorage.getItem('theme');
  if(themeLS) setTheme(themeLS);
  else if(window.matchMedia('(prefers-color-scheme: dark)').matches) setTheme('dark');
  else setTheme('light');

  const vol = +(localStorage.getItem('radioVolume')||'0.99');
  if(!isIOS && vol>=0 && vol<=1) {
    radioPlayer.volume = volumeSlider.value = vol;
    volumeIcon.textContent = vol==0 ? 'üîá' : 'üîä';
  }

  initPlayer();
});
radioPlayer.addEventListener('waiting', ()=>updateStatus('Loading...'));
radioPlayer.addEventListener('error', ()=>updateStatus('Error playing'));
radioPlayer.addEventListener('playing', ()=>updateStatus('Playing!'));

// Service Worker for PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load',() => {
    navigator.serviceWorker.register('sw.js')
    .then(reg => console.log('‚úîÔ∏è Service Worker registered:', reg))
    .catch(err => console.error('‚ùå Service Worker error:', err));
  });
}
</script>

</body>
</html>
